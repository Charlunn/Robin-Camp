<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”µå½±æ¢ç´¢è€… - Movies Explorer</title>
    <!-- å¼•å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ä½¿ç”¨ Noto Sans SC æ”¯æŒä¸­æ–‡ï¼ŒInter æ”¯æŒæ•°å­—å’Œè‹±æ–‡ */
        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            background-color: #111827; /* æ·±è‰²èƒŒæ™¯ */
            color: #f3f4f6;
        }
        /* ç”µå½±å¡ç‰‡ hover æ•ˆæœ */
        .movie-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
        }
        /* æŒ‰é’®æ¸å˜è‰² */
        .search-button {
            transition: all 0.3s ease;
            background-image: linear-gradient(to right, #4f46e5 0%, #7c3aed 100%);
        }
        .search-button:hover {
            background-image: linear-gradient(to right, #6366f1 0%, #8b5cf6 100%);
            transform: scale(1.02);
        }
        /* æ¨¡æ€æ¡†èƒŒæ™¯ */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.7);
        }
        
        /* ------------------------------------------------ */
        /* æ˜Ÿçº§è¯„åˆ†ä¿®å¤: ç§»é™¤é—´éš™å¹¶ä¿®å¤åŠæ˜Ÿé€»è¾‘                 */
        /* ------------------------------------------------ */
        .star-rating-container {
            direction: rtl; /* å€’åºæ’åˆ—æ˜Ÿæ˜Ÿï¼Œæ–¹ä¾¿ä»å³å¾€å·¦é€‰æ‹© */
            display: inline-flex;
            gap: 0; /* ç§»é™¤é—´éš™ */
            line-height: 1; /* ç¡®ä¿æ˜Ÿæ˜Ÿå±…ä¸­ä¸”æ— é¢å¤–è¡Œé«˜ */
        }
        .star-rating-container input[type="radio"] {
            display: none;
        }
        /* æ˜Ÿæ˜Ÿçš„é€šç”¨æ ·å¼ */
        .star-rating-container label {
            cursor: pointer;
            width: 1.25rem; /* 20px */
            height: 2.5rem; /* 40px */
            overflow: hidden;
            color: #4b5563; /* é»˜è®¤ç°è‰² */
            transition: color 0.2s;
            position: relative;
        }
        /* æ˜Ÿæ˜Ÿå›¾æ ‡ */
        .star-rating-container label::before {
            content: 'â˜…';
            display: block;
            width: 100%;
            font-size: 2.5rem; /* æ˜Ÿæ˜Ÿå¤§å° */
            line-height: 1;
        }
        /* å¥‡æ•°æ ‡ç­¾ (0.5, 1.5, ...) è´Ÿè´£å·¦åŠæ˜Ÿ */
        .star-rating-container label:nth-of-type(odd) {
            width: 1.25rem; /* 20px, ä¿æŒå…¨å®½ */
        }
        /* å¶æ•°æ ‡ç­¾ (1.0, 2.0, ...) è´Ÿè´£å³åŠæ˜Ÿ */
        .star-rating-container label:nth-of-type(even) {
            width: 1.25rem; /* 20px, ä¿æŒå…¨å®½ */
        }
        /* é€šè¿‡æ”¹å˜ margin æ¥æ§åˆ¶åŠæ˜Ÿçš„æ˜¾ç¤ºèŒƒå›´ */
        .star-rating-container label:nth-of-type(odd)::before {
            margin-left: -100%; /* æ˜¾ç¤ºå·¦åŠè¾¹ï¼ˆåŠæ˜Ÿï¼‰*/
        }
        .star-rating-container label:nth-of-type(even)::before {
            margin-right: -100%; /* æ˜¾ç¤ºå³åŠè¾¹ï¼ˆåŠæ˜Ÿï¼‰*/
        }
        /* æ‚¬åœ/é€‰ä¸­æ—¶çš„é¢œè‰² */
        .star-rating-container input:checked ~ label,
        .star-rating-container label:hover,
        .star-rating-container label:hover ~ label {
            color: #fde047; /* é»„è‰² */
        }
        /* ------------------------------------------------ */
    </style>
</head>
<body class="min-h-screen">

    <!-- åº”ç”¨å¤´éƒ¨ -->
    <header class="bg-gray-900 shadow-xl sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <h1 class="text-3xl font-extrabold text-indigo-400 tracking-tight">
                ğŸ¬ ç”µå½±æ¢ç´¢è€…
            </h1>
            <!-- ç®¡ç†å‘˜å…¥å£æŒ‰é’® -->
            <button id="admin-entry-button" onclick="showAdminLoginModal()" class="px-4 py-2 bg-pink-600 rounded-lg text-white font-semibold hover:bg-pink-700 transition duration-150">
                <span id="admin-status-text">ç®¡ç†å‘˜å…¥å£</span>
            </button>
        </div>
    </header>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">

        <!-- æœç´¢ä¸ç­›é€‰æ  -->
        <section class="mb-10 p-6 bg-gray-800 rounded-xl shadow-2xl">
            <h2 class="text-xl font-bold mb-4 text-white border-b border-gray-700 pb-2">ç”µå½±æœç´¢</h2>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                
                <!-- å…³é”®è¯æœç´¢ (q) -->
                <div>
                    <label for="search-query" class="block text-sm font-medium text-gray-300 mb-1">æ ‡é¢˜/å…³é”®è¯</label>
                    <input type="text" id="search-query" placeholder="ä¾‹å¦‚: Inception" class="w-full p-3 rounded-lg bg-gray-700 border border-gray-600 focus:ring-indigo-500 focus:border-indigo-500 text-white" />
                </div>

                <!-- å¹´ä»½ (year) -->
                <div>
                    <label for="search-year" class="block text-sm font-medium text-gray-300 mb-1">å‘è¡Œå¹´ä»½</label>
                    <input type="number" id="search-year" placeholder="ä¾‹å¦‚: 2010" min="1800" max="2100" class="w-full p-3 rounded-lg bg-gray-700 border border-gray-600 focus:ring-indigo-500 focus:border-indigo-500 text-white" />
                </div>

                <!-- ç±»å‹ (genre) -->
                <div>
                    <label for="search-genre" class="block text-sm font-medium text-gray-300 mb-1">ç”µå½±ç±»å‹</label>
                    <select id="search-genre" class="w-full p-3 rounded-lg bg-gray-700 border border-gray-600 focus:ring-indigo-500 focus:border-indigo-500 text-white appearance-none">
                        <option value="">æ‰€æœ‰ç±»å‹</option>
                        <option value="Sci-Fi">Sci-Fi (ç§‘å¹»)</option>
                        <option value="Action">Action (åŠ¨ä½œ)</option>
                        <option value="Drama">Drama (å‰§æƒ…)</option>
                        <option value="Crime">Crime (çŠ¯ç½ª)</option>
                        <option value="Adventure">Adventure (å†’é™©)</option>
                    </select>
                </div>
                
                <!-- æœç´¢æŒ‰é’® -->
                <div class="flex items-end">
                    <button onclick="performSearch()" class="search-button w-full p-3 rounded-lg text-white font-semibold shadow-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-gray-800">
                        <span id="search-status">æœç´¢ç”µå½±</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- ç”µå½±åˆ—è¡¨ç»“æœåŒº -->
        <section>
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-white">æœç´¢ç»“æœ <span id="movie-count" class="text-indigo-400 font-extrabold ml-2"></span></h2>
                <div id="loading-indicator" class="hidden flex items-center space-x-2 text-indigo-400 font-medium">
                    <svg class="animate-spin h-5 w-5 text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                    <span>åŠ è½½ä¸­...</span>
                </div>
            </div>
            
            <!-- ç”µå½±å¡ç‰‡å®¹å™¨ -->
            <div id="movie-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                <!-- ç”µå½±å¡ç‰‡å°†åœ¨æ­¤å¤„è¢«æ¸²æŸ“ -->
            </div>
            
            <!-- æ— ç»“æœæç¤º -->
            <div id="no-results" class="hidden text-center py-12">
                <p class="text-gray-400 text-xl">ğŸ˜” æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ç”µå½±ã€‚</p>
                <p class="text-gray-500 mt-2">è¯·å°è¯•æ›´æ”¹æ‚¨çš„æœç´¢æ¡ä»¶æˆ–æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œåœ¨ **http://localhost:8080**ã€‚</p>
            </div>
        </section>

        <!-- åˆ†é¡µæ§åˆ¶ (åŸºäº API æ–‡æ¡£ä¸­çš„ cursor æ¦‚å¿µ) -->
        <section class="mt-10 flex justify-center space-x-4">
            <button id="prev-page" class="px-6 py-3 bg-gray-700 rounded-lg text-gray-300 font-semibold transition duration-150 disabled:opacity-50" disabled>
                ä¸Šä¸€é¡µ
            </button>
            <button id="next-page" onclick="goToNextPage()" class="px-6 py-3 bg-indigo-600 rounded-lg text-white font-semibold hover:bg-indigo-700 transition duration-150 disabled:opacity-50" disabled>
                ä¸‹ä¸€é¡µ
            </button>
        </section>
        
        <!-- æ¶ˆæ¯æç¤ºæ¡† -->
        <div id="error-message-box" class="fixed bottom-4 right-4 p-4 bg-red-600 text-white rounded-lg shadow-xl hidden transition-opacity duration-300 opacity-0" role="alert">
            <span id="error-text"></span>
        </div>
        <div id="success-message-box" class="fixed bottom-4 right-4 p-4 bg-green-600 text-white rounded-lg shadow-xl hidden transition-opacity duration-300 opacity-0" role="alert">
            <span id="success-text"></span>
        </div>
    </main>

    <!-- 1. è¯„åˆ†/Rater ID æ¨¡æ€æ¡† -->
    <div id="rating-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-backdrop">
        <div class="bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-lg mx-4 transform transition-all">
            <h3 class="text-2xl font-bold text-white mb-4 border-b border-gray-700 pb-2">æäº¤ç”µå½±è¯„åˆ†</h3>
            <p class="text-gray-400 mb-4">ç”µå½±æ ‡é¢˜: <strong id="modal-movie-title" class="text-indigo-400"></strong></p>
            
            <!-- Rater ID è¾“å…¥ (ä»…åœ¨æœªè®¾ç½®æ—¶æ˜¾ç¤º) -->
            <div id="rater-id-prompt" class="space-y-4 mb-4 p-4 bg-gray-700 rounded-lg border border-yellow-500 hidden">
                <label for="modal-rater-id" class="block text-sm font-medium text-yellow-300">è¯·è¾“å…¥æ‚¨çš„ Rater ID (X-Rater-Id)</label>
                <input type="text" id="modal-rater-id" placeholder="ä¾‹å¦‚: user_abc" class="w-full p-3 rounded-lg bg-gray-600 border border-gray-500 focus:ring-yellow-500 text-white" />
            </div>

            <!-- äº¤äº’å¼æ˜Ÿçº§è¯„åˆ† -->
            <div class="mt-6 mb-8 text-center">
                <p class="text-lg font-semibold text-white mb-3">æ‚¨çš„è¯„åˆ†:</p>
                <div id="star-rating-area" class="star-rating-container mx-auto">
                    <!-- åŠ¨æ€ç”Ÿæˆ 10 ä¸ªåŠæ˜Ÿè¾“å…¥ -->
                </div>
                <p id="current-rating-value" class="text-xl font-extrabold mt-3 text-yellow-400">0.0 / 5.0</p>
            </div>

            <!-- æŒ‰é’® -->
            <div class="flex justify-end space-x-3">
                <button onclick="closeRatingModal()" class="px-5 py-2 bg-gray-600 rounded-lg text-white hover:bg-gray-700 transition">å–æ¶ˆ</button>
                <button id="submit-rating-btn" onclick="handleRatingSubmission()" class="px-5 py-2 bg-blue-600 rounded-lg text-white font-semibold hover:bg-blue-700 transition">ç¡®è®¤æäº¤</button>
            </div>
        </div>
    </div>
    
    <!-- 2. ç®¡ç†å‘˜ç™»å½•æ¨¡æ€æ¡† -->
    <div id="admin-login-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-backdrop">
        <div class="bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-md mx-4 transform transition-all">
            <h3 class="text-2xl font-bold text-white mb-4 border-b border-gray-700 pb-2">ç®¡ç†å‘˜ç™»å½•</h3>
            
            <div id="admin-logout-area" class="space-y-4 mb-4 hidden">
                <p class="text-green-400 text-lg font-semibold">æ‚¨å·²ç™»å½•ç®¡ç†å‘˜èº«ä»½ã€‚</p>
                <button onclick="showAddMovieModal()" class="w-full p-3 bg-indigo-600 rounded-lg text-white font-semibold hover:bg-indigo-700 transition">
                    æ·»åŠ æ–°ç”µå½±
                </button>
                <button onclick="adminLogout()" class="w-full p-3 bg-gray-600 rounded-lg text-white hover:bg-gray-700 transition">
                    é€€å‡ºç®¡ç†å‘˜
                </button>
            </div>

            <div id="admin-login-area" class="space-y-4 mb-4">
                <label for="admin-key-input" class="block text-sm font-medium text-gray-300">ç®¡ç†å‘˜ç§é’¥ (ä½œä¸º Bearer Token)</label>
                <input type="password" id="admin-key-input" placeholder="è¾“å…¥ç§é’¥..." class="w-full p-3 rounded-lg bg-gray-700 border border-gray-600 focus:ring-pink-500 text-white" />
                <div class="flex justify-end space-x-3 pt-2">
                    <button onclick="closeAdminLoginModal()" class="px-5 py-2 bg-gray-600 rounded-lg text-white hover:bg-gray-700 transition">å–æ¶ˆ</button>
                    <button onclick="adminLogin()" class="px-5 py-2 bg-pink-600 rounded-lg text-white font-semibold hover:bg-pink-700 transition">ç™»å½•</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. æ·»åŠ ç”µå½±æ¨¡æ€æ¡† -->
    <div id="add-movie-modal" class="fixed inset-0 z-50 flex items-center justify-center hidden modal-backdrop">
        <div class="bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-lg mx-4 transform transition-all">
            <h3 class="text-2xl font-bold text-white mb-4 border-b border-gray-700 pb-2">æ·»åŠ æ–°ç”µå½±</h3>
            <form id="add-movie-form" class="space-y-4">
                <div>
                    <label for="movie-title" class="block text-sm font-medium text-gray-300">æ ‡é¢˜ <span class="text-red-500">*</span></label>
                    <input type="text" id="movie-title" required class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 text-white" />
                </div>
                <div>
                    <label for="movie-genre" class="block text-sm font-medium text-gray-300">ç±»å‹ <span class="text-red-500">*</span></label>
                    <input type="text" id="movie-genre" required class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 text-white" />
                </div>
                <div>
                    <label for="movie-releaseDate" class="block text-sm font-medium text-gray-300">å‘è¡Œæ—¥æœŸ <span class="text-red-500">*</span></label>
                    <input type="date" id="movie-releaseDate" required class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 text-white" />
                </div>
                <!-- å¯é€‰å­—æ®µ -->
                <div>
                    <label for="movie-distributor" class="block text-sm font-medium text-gray-300">å‘è¡Œå•†</label>
                    <input type="text" id="movie-distributor" class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 text-white" />
                </div>
                <div>
                    <label for="movie-budget" class="block text-sm font-medium text-gray-300">é¢„ç®— (USD)</label>
                    <input type="number" id="movie-budget" min="0" class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 text-white" />
                </div>
                <div>
                    <label for="movie-mpaRating" class="block text-sm font-medium text-gray-300">MPA è¯„çº§</label>
                    <input type="text" id="movie-mpaRating" placeholder="ä¾‹å¦‚: PG-13, R" class="w-full p-2 rounded-lg bg-gray-700 border border-gray-600 text-white" />
                </div>
            </form>

            <div class="flex justify-end space-x-3 pt-6">
                <button onclick="closeAddMovieModal()" class="px-5 py-2 bg-gray-600 rounded-lg text-white hover:bg-gray-700 transition">å–æ¶ˆ</button>
                <button onclick="addMovie()" class="px-5 py-2 bg-indigo-600 rounded-lg text-white font-semibold hover:bg-indigo-700 transition">æäº¤æ·»åŠ </button>
            </div>
        </div>
    </div>


    <!-- æ³¨å…¥å‰ç«¯é…ç½®ï¼ˆç”± nginx åœ¨å®¹å™¨å¯åŠ¨æ—¶ç”Ÿæˆçš„ config.jsï¼‰ -->
    <script src="config.js"></script>
    <script>
        // --- å…¨å±€é…ç½® ---
        const API_BASE_URL = (window.APP_CONFIG && window.APP_CONFIG.API_BASE_URL) || 'http://localhost:8080';
        const API_MOVIES_ENDPOINT = '/movies';
        const PAGE_SIZE = 12; 
        const RATING_VALUES = [0.5, 1.0, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 4.5, 5.0];

        // --- çŠ¶æ€å˜é‡ ---
        let currentCursor = null; 
        let raterId = localStorage.getItem('raterId') || '';
        let adminToken = localStorage.getItem('adminToken') || ''; // å­˜å‚¨ç®¡ç†å‘˜ JWT/Token
        let currentMovieId = ''; // å­˜å‚¨å½“å‰æ­£åœ¨è¯„åˆ†çš„ç”µå½±ID
        let currentMovieTitle = ''; // å­˜å‚¨å½“å‰æ­£åœ¨è¯„åˆ†çš„ç”µå½±æ ‡é¢˜
        let selectedRating = 0.0; // å­˜å‚¨æ¨¡æ€æ¡†ä¸­é€‰æ‹©çš„è¯„åˆ†
        
        // --- DOM å…ƒç´ å¼•ç”¨ ---
        const movieListContainer = document.getElementById('movie-list');
        const searchButton = document.getElementById('search-status');
        const nextButton = document.getElementById('next-page');
        const loadingIndicator = document.getElementById('loading-indicator');
        const noResultsElement = document.getElementById('no-results');
        const movieCountElement = document.getElementById('movie-count');
        const errorMessageBox = document.getElementById('error-message-box');
        const errorText = document.getElementById('error-text');
        const successMessageBox = document.getElementById('success-message-box');
        const successText = document.getElementById('success-text');

        // --- è¾…åŠ©å‡½æ•° ---

        // æ˜¾ç¤ºè‡ªå®šä¹‰æˆåŠŸæ¶ˆæ¯æ¡†
        function showCustomSuccess(message) {
            successText.textContent = message;
            successMessageBox.classList.remove('hidden');
            setTimeout(() => successMessageBox.classList.add('opacity-100'), 10);
            
            setTimeout(() => {
                successMessageBox.classList.remove('opacity-100');
                setTimeout(() => successMessageBox.classList.add('hidden'), 300);
            }, 4000);
        }

        // æ˜¾ç¤ºè‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯æ¡†
        function showCustomAlert(message) {
            errorText.textContent = message;
            errorMessageBox.classList.remove('hidden');
            setTimeout(() => errorMessageBox.classList.add('opacity-100'), 10);
            
            setTimeout(() => {
                errorMessageBox.classList.remove('opacity-100');
                setTimeout(() => errorMessageBox.classList.add('hidden'), 300);
            }, 4000);
        }

        // æ ¼å¼åŒ–é¢„ç®—æ•°å­—ä¸ºå¯è¯»çš„å­—ç¬¦ä¸²
        function formatBudget(amount) {
            if (typeof amount !== 'number' || amount <= 0) return 'N/A';
            if (amount >= 1000000000) {
                return `$${(amount / 1000000000).toFixed(2)} B`;
            }
            if (amount >= 1000000) {
                return `$${(amount / 1000000).toFixed(1)} M`;
            }
            return `$${amount.toLocaleString()}`;
        }
        
        // --- API è°ƒç”¨é€»è¾‘ (GET /movies) ---

        async function fetchMovies(cursor = null) {
            const params = new URLSearchParams();
            const q = document.getElementById('search-query').value.trim();
            if (q) params.append('q', q);
            const year = document.getElementById('search-year').value.trim();
            if (year) params.append('year', year);
            const genre = document.getElementById('search-genre').value;
            if (genre) params.append('genre', genre);
            
            params.append('limit', PAGE_SIZE);

            if (cursor) {
                params.append('cursor', cursor);
            }
            
            const url = `${API_BASE_URL}${API_MOVIES_ENDPOINT}?${params.toString()}`;
            console.log('Fetching URL:', url); 

            try {
                const response = await fetch(url);
                
                if (!response.ok) {
                    let errorData = await response.json().catch(() => ({ message: `è¯·æ±‚å¤±è´¥ï¼ŒHTTP çŠ¶æ€ç : ${response.status}` }));
                    throw new Error(errorData.message || 'æœªçŸ¥é”™è¯¯');
                }
                
                const data = await response.json(); 
                return data;

            } catch (error) {
                console.error('API Error:', error);
                // é‡ç‚¹ï¼šå½“é‡åˆ°ç½‘ç»œé”™è¯¯ï¼ˆå¦‚ Failed to fetchï¼‰æ—¶ï¼Œç»™å‡ºæ˜ç¡®çš„ CORS/æœåŠ¡å™¨æ£€æŸ¥æç¤º
                showCustomAlert(`æœç´¢ API è¯·æ±‚å¤±è´¥ã€‚é”™è¯¯ä¿¡æ¯: ${error.message}ã€‚è¯·æ£€æŸ¥åç«¯æœåŠ¡ (http://localhost:8080) æ˜¯å¦è¿è¡Œæ­£å¸¸ï¼Œä»¥åŠæ˜¯å¦é…ç½®äº† CORS è·¨åŸŸè®¿é—®ç­–ç•¥ã€‚`);
                return { items: [], nextCursor: null, error: error.message }; 
            }
        }

        // æ–°å¢ API è°ƒç”¨: GET /movies/{title}/rating (èšåˆè¯„åˆ†)
        async function fetchRatingAggregate(movieTitle) {
            const url = `${API_BASE_URL}${API_MOVIES_ENDPOINT}/${encodeURIComponent(movieTitle)}/rating`;
            
            try {
                const response = await fetch(url);
                if (response.status === 404) {
                    // ç”µå½±å­˜åœ¨ä½†æ²¡æœ‰è¯„åˆ†
                    return { average: 0.0, count: 0 };
                }
                if (!response.ok) {
                    throw new Error(`è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç : ${response.status}`);
                }
                
                return await response.json(); // { average: 4.3, count: 128 }
            } catch (error) {
                console.warn(`æ— æ³•è·å– ${movieTitle} çš„è¯„åˆ†: ${error.message}`);
                // è¿”å›é»˜è®¤å€¼ï¼Œä¸ä¸­æ–­æ¸²æŸ“
                return { average: null, count: null };
            }
        }
        
        // API è°ƒç”¨: POST /movies/{title}/ratings (æäº¤è¯„åˆ†)
        async function submitRatingAPI(movieId, movieTitle, ratingValue, raterId) {
            const url = `${API_BASE_URL}${API_MOVIES_ENDPOINT}/${encodeURIComponent(movieTitle)}/ratings`;
            const ratingPayload = { rating: ratingValue };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Rater-Id': raterId
                    },
                    body: JSON.stringify(ratingPayload)
                });

                let data = await response.json().catch(() => ({}));

                if (response.ok) {
                    const statusText = response.status === 201 ? 'åˆ›å»ºæˆåŠŸ' : 'æ›´æ–°æˆåŠŸ';
                    // ä¿®å¤ï¼šä½¿ç”¨ selectedRatingï¼Œä»¥é˜² data.rating ç¼ºå¤±ï¼ˆè™½ç„¶æ ¹æ® API æ–‡æ¡£ä¸åº”å‘ç”Ÿï¼‰
                    const actualRating = data.rating || ratingValue;
                    showCustomSuccess(`è¯„åˆ†æäº¤æˆåŠŸ (${statusText})! ${movieTitle} è¯„åˆ†: ${actualRating}`);
                    // è¯„åˆ†æˆåŠŸåï¼Œåˆ·æ–°è¯¥ç”µå½±å¡ç‰‡çš„èšåˆè¯„åˆ†
                    refreshMovieRating(movieId, movieTitle);
                } else {
                    const errorMessage = data.message || `è¯·æ±‚å¤±è´¥ï¼ŒHTTP çŠ¶æ€ç : ${response.status}`;
                    showCustomAlert(`è¯„åˆ†æäº¤å¤±è´¥: ${errorMessage}`);
                }

            } catch (error) {
                console.error('Network Error during rating submission:', error);
                // é‡ç‚¹ï¼šå½“é‡åˆ°ç½‘ç»œé”™è¯¯ï¼ˆå¦‚ Failed to fetchï¼‰æ—¶ï¼Œç»™å‡ºæ˜ç¡®çš„ CORS/æœåŠ¡å™¨æ£€æŸ¥æç¤º
                showCustomAlert(`è¯„åˆ† API è¯·æ±‚å¤±è´¥ã€‚é”™è¯¯ä¿¡æ¯: ${error.message}ã€‚è¿™é€šå¸¸æ˜¯ç”±äºç½‘ç»œè¿æ¥å¤±è´¥æˆ–åç«¯ CORS é…ç½®é”™è¯¯å¯¼è‡´çš„ã€‚`);
            }
        }

        // API è°ƒç”¨: POST /movies (æ·»åŠ ç”µå½±)
        async function addMovieAPI(movieData) {
            const url = `${API_BASE_URL}${API_MOVIES_ENDPOINT}`;
            
            // ç¡®ä¿ adminToken å­˜åœ¨
            if (!adminToken) {
                 showCustomAlert('ç®¡ç†å‘˜ Token ç¼ºå¤±ã€‚è¯·é‡æ–°ç™»å½•ã€‚');
                 return;
            }

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${adminToken}` // ä½¿ç”¨ç®¡ç†å‘˜ token
                    },
                    body: JSON.stringify(movieData)
                });

                let data = await response.json().catch(() => ({}));
                
                if (response.status === 201) {
                    showCustomSuccess(`ç”µå½±æ·»åŠ æˆåŠŸ! ID: ${data.id || 'æœªçŸ¥'}`);
                    window.location.reload(); // åˆ·æ–°é¡µé¢ä»¥ç¡®ä¿çŠ¶æ€æ›´æ–°
                } else {
                    const errorMessage = data.message || `æ·»åŠ ç”µå½±å¤±è´¥ï¼ŒçŠ¶æ€ç : ${response.status}`;
                    showCustomAlert(`æ·»åŠ ç”µå½±å¤±è´¥: ${errorMessage}`);
                }
            } catch (error) {
                console.error('Network Error during movie creation:', error);
                // é‡ç‚¹ï¼šå½“é‡åˆ°ç½‘ç»œé”™è¯¯ï¼ˆå¦‚ Failed to fetchï¼‰æ—¶ï¼Œç»™å‡ºæ˜ç¡®çš„ CORS/æœåŠ¡å™¨æ£€æŸ¥æç¤º
                showCustomAlert(`æ·»åŠ ç”µå½± API è¯·æ±‚å¤±è´¥ã€‚é”™è¯¯ä¿¡æ¯: ${error.message}ã€‚è¯·ç¡®è®¤åç«¯æœåŠ¡è¿è¡Œæ­£å¸¸å¹¶å·²å…è®¸è·¨åŸŸè®¿é—® (CORS)ã€‚`);
            } finally {
                closeAddMovieModal();
            }
        }

        // --- æ¸²æŸ“ä¸æ§åˆ¶é€»è¾‘ ---

        // æ¸²æŸ“å•ä¸ªç”µå½±å¡ç‰‡
        function renderMovieCard(movie) {
            const budget = formatBudget(movie.budget);
            const mpaRating = movie.mpaRating || 'N/A';
            const releaseYear = movie.releaseDate ? new Date(movie.releaseDate).getFullYear() : 'N/A';
            
            // é‡ç‚¹ä¿®å¤ï¼š
            // 1. ä½¿ç”¨ movie.id ä½œä¸º DOM å…ƒç´ çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œé¿å…æ ‡é¢˜ä¸­çš„ç‰¹æ®Šå­—ç¬¦å¯¼è‡´ ID å¤±æ•ˆã€‚
            // 2. é€šè¿‡ data-* å±æ€§ä¼ å‚ï¼Œé¿å… onclick ä¸­çš„å¼•å·å†²çªã€‚
            // 3. å¯¹æ ‡é¢˜ä½¿ç”¨ encodeURIComponent ç¼–ç ï¼Œåœ¨ç‚¹å‡»æ—¶å†è§£ç ã€‚
            const encodedTitle = encodeURIComponent(movie.title || 'æ— æ ‡é¢˜');

            return `
                <div id="movie-card-${movie.id}" class="movie-card bg-gray-800 rounded-xl overflow-hidden shadow-lg border border-gray-700 transition duration-300">
                    <div class="p-6">
                        <div class="flex items-start justify-between">
                            <h3 class="text-xl font-bold text-indigo-400 leading-tight">
                                ${movie.title || 'æ— æ ‡é¢˜'}
                            </h3>
                            <span class="text-xs font-semibold px-2 py-1 rounded-full bg-indigo-600 text-white ml-2">
                                ${mpaRating}
                            </span>
                        </div>
                        <p class="text-sm text-gray-500 mb-4">ID: ${movie.id} / ${releaseYear}</p>
                        
                        <!-- èšåˆè¯„åˆ†æ˜¾ç¤ºåŒºåŸŸ (ä½¿ç”¨ movie.id) -->
                        <div id="rating-info-${movie.id}" class="flex items-center space-x-2 mb-4">
                            <svg class="animate-pulse h-5 w-5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.381-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                            <span class="text-sm text-gray-400">åŠ è½½è¯„åˆ†...</span>
                        </div>

                        <!-- è¯„åˆ†æŒ‰é’®ï¼šä½¿ç”¨ data-* ä¼ å‚ï¼Œé¿å…å¼•å·å†²çª -->
                        <button
                            data-id="${movie.id}"
                            data-title="${encodedTitle}"
                            onclick="showRatingModal(this.dataset.id, decodeURIComponent(this.dataset.title))"
                            class="mt-2 w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 rounded-lg transition duration-150 shadow-md shadow-blue-500/30">
                            æˆ‘è¦è¯„åˆ†
                        </button>
                        
                        <!-- è¯¦æƒ…æ ‡ç­¾ -->
                        <div class="space-y-2 text-sm mt-4 pt-4 border-t border-gray-700">
                            <p class="text-gray-400">
                                <span class="font-semibold text-gray-200">ç±»å‹:</span> 
                                <span class="bg-gray-700 text-indigo-300 px-2 py-0.5 rounded-full">${movie.genre || 'N/A'}</span>
                            </p>
                            <p class="text-gray-400">
                                <span class="font-semibold text-gray-200">é¢„ç®—:</span> 
                                <span class="font-mono text-green-400">${budget}</span>
                            </p>
                            <p class="text-gray-400">
                                <span class="font-semibold text-gray-200">å‘è¡Œå•†:</span> 
                                <span class="text-gray-300">${movie.distributor || 'N/A'}</span>
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // æ›´æ–°ç”µå½±å¡ç‰‡ä¸Šçš„èšåˆè¯„åˆ†æ˜¾ç¤º
        function updateRatingDisplay(movieId, average, count) {
            const displayEl = document.getElementById(`rating-info-${movieId}`);
            if (!displayEl) return;
            
            if (average !== null && count !== null && count > 0) {
                const formattedAverage = average.toFixed(1);
                displayEl.innerHTML = `
                    <svg class="h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.381-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                    <span class="text-lg font-bold text-yellow-400">${formattedAverage}</span>
                    <span class="text-sm text-gray-400">(${count.toLocaleString()} è¯„åˆ†)</span>
                `;
            } else {
                 displayEl.innerHTML = `
                    <svg class="h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.381-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                    <span class="text-sm text-gray-500">æš‚æ— è¯„åˆ†</span>
                `;
            }
        }
        
        // åˆ·æ–°å•éƒ¨ç”µå½±çš„è¯„åˆ†
        async function refreshMovieRating(movieId, movieTitle) {
             const result = await fetchRatingAggregate(movieTitle);
             updateRatingDisplay(movieId, result.average, result.count);
        }

        // æ¸²æŸ“ç”µå½±åˆ—è¡¨å¹¶è§¦å‘è¯„åˆ†èšåˆè°ƒç”¨
        function renderList(movies) {
            movieListContainer.innerHTML = '';
            if (movies.length === 0) {
                noResultsElement.classList.remove('hidden');
            } else {
                noResultsElement.classList.add('hidden');
                movies.forEach(movie => {
                    movieListContainer.innerHTML += renderMovieCard(movie);
                });
            }
            movieCountElement.textContent = `(${movies.length} éƒ¨)`;

            // çº§è”è°ƒç”¨ï¼šå¹¶è¡Œè·å–æ¯éƒ¨ç”µå½±çš„èšåˆè¯„åˆ†
            const ratingPromises = movies.map(movie => fetchRatingAggregate(movie.title));
            Promise.allSettled(ratingPromises).then(results => {
                results.forEach((result, index) => {
                    const movie = movies[index];
                    if (result.status === 'fulfilled' && result.value) {
                        updateRatingDisplay(movie.id, result.value.average, result.value.count);
                    } else {
                         updateRatingDisplay(movie.id, null, null);
                    }
                });
            });
        }
        
        function updatePaginationButtons(nextCursor) {
            // API æ–‡æ¡£åªæä¾›äº† nextCursorï¼Œå› æ­¤æˆ‘ä»¬ç¦ç”¨ "ä¸Šä¸€é¡µ" æŒ‰é’®ã€‚
            document.getElementById('prev-page').disabled = true; 
            nextButton.disabled = !nextCursor;
        }

        // æ‰§è¡Œæ–°çš„æœç´¢
        async function performSearch() {
            currentCursor = null; 
            loadingIndicator.classList.remove('hidden');
            searchButton.textContent = 'æœç´¢ä¸­...';
            searchButton.disabled = true;
            movieListContainer.innerHTML = '';
            
            const response = await fetchMovies(currentCursor);
            
            if (response.items) {
                renderList(response.items);
                currentCursor = response.nextCursor || null;
                updatePaginationButtons(currentCursor);
            } else {
                 renderList([]); 
                 updatePaginationButtons(null);
            }
            
            loadingIndicator.classList.add('hidden');
            searchButton.textContent = 'æœç´¢ç”µå½±';
            searchButton.disabled = false;
        }
        
        // åˆ†é¡µè·³è½¬åˆ°ä¸‹ä¸€é¡µ
        async function goToNextPage() {
            if (!currentCursor) return;
            
            loadingIndicator.classList.remove('hidden');
            nextButton.disabled = true;
            movieListContainer.innerHTML = '';
            
            const response = await fetchMovies(currentCursor);
            
            if (response.items) {
                renderList(response.items); 
                currentCursor = response.nextCursor || null;
                updatePaginationButtons(currentCursor);
            } else {
                updatePaginationButtons(null);
            }
            
            loadingIndicator.classList.add('hidden');
        }

        // --- æ¨¡æ€æ¡†ä¸è¯„åˆ†é€»è¾‘ ---

        // æ¸²æŸ“æ˜Ÿçº§è¯„åˆ†æ§ä»¶
        function renderStarRating() {
            const area = document.getElementById('star-rating-area');
            area.innerHTML = '';
            // 5 é¢—æ˜Ÿï¼Œæ¯é¢—æ˜Ÿå¯¹åº” 0.5 å¢é‡ï¼Œå…± 10 ä¸ª radio
            for (let i = 10; i >= 1; i--) {
                const value = i / 2;
                const input = document.createElement('input');
                input.type = 'radio';
                input.id = `star-${value}`;
                input.name = 'rating';
                input.value = value;
                input.addEventListener('change', () => {
                    selectedRating = value;
                    document.getElementById('current-rating-value').textContent = `${value.toFixed(1)} / 5.0`;
                });

                const label = document.createElement('label');
                label.htmlFor = `star-${value}`;
                label.title = `${value.toFixed(1)} æ˜Ÿ`;
                
                area.appendChild(input);
                area.appendChild(label);
            }
        }
        
        // æ˜¾ç¤ºè¯„åˆ†æ¨¡æ€æ¡†
        function showRatingModal(movieId, movieTitle) {
            currentMovieId = movieId;
            currentMovieTitle = movieTitle;
            selectedRating = 0.0; // é‡ç½®è¯„åˆ†
            
            document.getElementById('modal-movie-title').textContent = movieTitle;
            document.getElementById('rating-modal').classList.remove('hidden');
            document.body.classList.add('overflow-hidden'); // é˜²æ­¢èƒŒæ™¯æ»šåŠ¨
            
            renderStarRating(); // æ¸²æŸ“æ˜Ÿçº§æ§ä»¶
            document.getElementById('current-rating-value').textContent = '0.0 / 5.0';

            // æ£€æŸ¥ Rater ID æ˜¯å¦å­˜åœ¨
            raterId = localStorage.getItem('raterId');
            const raterIdPrompt = document.getElementById('rater-id-prompt');
            if (!raterId) {
                raterIdPrompt.classList.remove('hidden');
                document.getElementById('modal-rater-id').value = '';
            } else {
                raterIdPrompt.classList.add('hidden');
            }
        }

        // å…³é—­è¯„åˆ†æ¨¡æ€æ¡†ï¼ˆä¸æ¸…ç©ºå½“å‰ç”µå½±IDå’Œæ ‡é¢˜ï¼Œä»¥ä¾¿æäº¤åä»å¯ä½¿ç”¨ï¼‰
        function closeRatingModal() {
            document.getElementById('rating-modal').classList.add('hidden');
            document.body.classList.remove('overflow-hidden');
        }

        // å¤„ç†è¯„åˆ†æäº¤
        function handleRatingSubmission() {
            let finalRaterId = localStorage.getItem('raterId');
            
            // 1. å¦‚æœ Rater ID æœªè®¾ç½®ï¼Œå°è¯•ä»æ¨¡æ€æ¡†è·å–å¹¶ä¿å­˜
            if (!finalRaterId) {
                const inputId = document.getElementById('modal-rater-id').value.trim();
                if (!inputId) {
                    showCustomAlert('è¯·å…ˆè¾“å…¥æ‚¨çš„ Rater IDã€‚');
                    return;
                }
                localStorage.setItem('raterId', inputId);
                finalRaterId = inputId;
            }

            // 2. æ£€æŸ¥è¯„åˆ†æ˜¯å¦é€‰æ‹©
            if (selectedRating === 0.0) {
                showCustomAlert('è¯·ç‚¹å‡»æ˜Ÿæ˜Ÿé€‰æ‹©æ‚¨çš„è¯„åˆ†ã€‚');
                return;
            }

            // 3. æäº¤è¯„åˆ†ï¼ˆé˜²æŠ¤ï¼šç¡®ä¿æ ‡é¢˜å­˜åœ¨ï¼‰
            if (!currentMovieTitle) {
                const fallbackTitle = document.getElementById('modal-movie-title')?.textContent?.trim();
                if (fallbackTitle) {
                    currentMovieTitle = fallbackTitle;
                } else {
                    showCustomAlert('ç³»ç»Ÿæœªè·å–åˆ°å½±ç‰‡æ ‡é¢˜ï¼Œè¯·é‡è¯•æ‰“å¼€è¯„åˆ†å¼¹çª—ã€‚');
                    return;
                }
            }
            closeRatingModal();
            submitRatingAPI(currentMovieId, currentMovieTitle, selectedRating, finalRaterId);
        }

        // --- ç®¡ç†å‘˜é€»è¾‘ ---
        
        // æ›´æ–°ç®¡ç†å‘˜æŒ‰é’®çŠ¶æ€
        function updateAdminStatus() {
            const adminStatusText = document.getElementById('admin-status-text');
            if (localStorage.getItem('adminToken')) {
                adminStatusText.textContent = 'ç®¡ç†å‘˜ (å·²ç™»å½•)';
                adminStatusText.classList.add('text-yellow-300');
            } else {
                adminStatusText.textContent = 'ç®¡ç†å‘˜å…¥å£';
                adminStatusText.classList.remove('text-yellow-300');
            }
        }

        // æ˜¾ç¤ºç®¡ç†å‘˜ç™»å½•æ¨¡æ€æ¡†
        function showAdminLoginModal() {
            document.getElementById('admin-login-modal').classList.remove('hidden');
            document.body.classList.add('overflow-hidden');

            const loginArea = document.getElementById('admin-login-area');
            const logoutArea = document.getElementById('admin-logout-area');

            if (localStorage.getItem('adminToken')) {
                loginArea.classList.add('hidden');
                logoutArea.classList.remove('hidden');
            } else {
                loginArea.classList.remove('hidden');
                logoutArea.classList.add('hidden');
            }
        }

        // å…³é—­ç®¡ç†å‘˜ç™»å½•æ¨¡æ€æ¡†
        function closeAdminLoginModal() {
            document.getElementById('admin-login-modal').classList.add('hidden');
            document.body.classList.remove('overflow-hidden');
        }

        // ç®¡ç†å‘˜ç™»å½•
        function adminLogin() {
            const key = document.getElementById('admin-key-input').value.trim();
            if (key) {
                // å‡è®¾ç§é’¥å³ä¸º JWT/Tokenï¼Œç›´æ¥å­˜å‚¨
                adminToken = key;
                localStorage.setItem('adminToken', adminToken);
                showCustomSuccess('ç®¡ç†å‘˜ç™»å½•æˆåŠŸï¼');
                updateAdminStatus();
                closeAdminLoginModal();
            } else {
                showCustomAlert('ç§é’¥ä¸èƒ½ä¸ºç©ºï¼');
            }
        }

        // é€€å‡ºç®¡ç†å‘˜
        function adminLogout() {
            adminToken = '';
            localStorage.removeItem('adminToken');
            showCustomSuccess('å·²é€€å‡ºç®¡ç†å‘˜èº«ä»½ã€‚');
            updateAdminStatus();
            closeAdminLoginModal();
        }

        // æ˜¾ç¤ºæ·»åŠ ç”µå½±æ¨¡æ€æ¡†
        function showAddMovieModal() {
            if (!adminToken) {
                showCustomAlert('è¯·å…ˆç™»å½•ç®¡ç†å‘˜èº«ä»½ã€‚');
                closeAdminLoginModal();
                return;
            }
            document.getElementById('add-movie-modal').classList.remove('hidden');
            closeAdminLoginModal(); // å…³é—­ç™»å½•æ¨¡æ€æ¡†
        }

        // å…³é—­æ·»åŠ ç”µå½±æ¨¡æ€æ¡†
        function closeAddMovieModal() {
            document.getElementById('add-movie-modal').classList.add('hidden');
            document.body.classList.remove('overflow-hidden');
            document.getElementById('add-movie-form').reset(); // é‡ç½®è¡¨å•
        }

        // æäº¤æ·»åŠ ç”µå½±è¡¨å•
        function addMovie() {
            const form = document.getElementById('add-movie-form');
            if (!form.checkValidity()) {
                 showCustomAlert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ (*)ã€‚');
                 return;
            }
            
            const movieData = {
                title: document.getElementById('movie-title').value,
                genre: document.getElementById('movie-genre').value,
                releaseDate: document.getElementById('movie-releaseDate').value,
            };

            // æ·»åŠ å¯é€‰å­—æ®µ
            const distributor = document.getElementById('movie-distributor').value;
            if (distributor) movieData.distributor = distributor;
            const budget = parseInt(document.getElementById('movie-budget').value);
            if (!isNaN(budget) && budget > 0) movieData.budget = budget;
            const mpaRating = document.getElementById('movie-mpaRating').value;
            if (mpaRating) movieData.mpaRating = mpaRating;

            addMovieAPI(movieData);
        }

        // åˆå§‹åŒ–åŠ è½½
        window.onload = () => {
            updateAdminStatus(); // æ£€æŸ¥æ˜¯å¦æœ‰å·²å­˜å‚¨çš„ç®¡ç†å‘˜ Token
            performSearch();
        };
    </script>
</body>
</html>
